{% extends "admin_app/admin_dashboard.html" %}
{% load static %}
{% block admin_content %}
<h2>Gérer la campagne : {{ campaign.name }}</h2>

<input type="hidden" id="campaign-id" value="{{ campaign.id }}">
<form method="post" id="campaign-form">
  {% csrf_token %}

  <div class="d-flex gap-5">
    <!-- Voitures -->
    <div>
      <h3>Voitures disponibles</h3>
      <ul id="cars-available" class="list-group droppable">
        {% for car in cars %}
          {% if car not in campaign.cars.all %}
            <li class="list-group-item draggable" draggable="true" data-id="{{ car.id }}">{{ car.name }}</li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>

    <div>
      <h3>Voitures sélectionnées</h3>
      <ul id="cars-selected" class="list-group droppable">
        {% for car in campaign.cars.all %}
          <li class="list-group-item draggable" draggable="true" data-id="{{ car.id }}">{{ car.name }}</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <hr>

  <div class="d-flex gap-5">
    <!-- Layouts -->
    <div>
      <h3>Layouts disponibles</h3>
      <ul id="layouts-available" class="list-group droppable">
        {% for layout in layouts %}
          {% if layout not in campaign.layouts.all %}
            <li class="list-group-item draggable" draggable="true" data-id="{{ layout.id }}">
              {{ layout.track.name }} – {{ layout.name }}
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>

    <div>
      <h3>Layouts sélectionnés</h3>
      <ul id="layouts-selected" class="list-group droppable">
        {% for layout in campaign.layouts.all %}
          <li class="list-group-item draggable" draggable="true" data-id="{{ layout.id }}">
            {{ layout.track.name }} – {{ layout.name }}
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Champs cachés -->
  <input type="hidden" name="cars" id="cars-input">
  <input type="hidden" name="layouts" id="layouts-input">

  <button type="submit" class="btn btn-success mt-3">Sauvegarder</button>
</form>
<script src="{% static 'admin_app/js/campaign.js' %}"></script>
<style>
  .droppable { min-height: 10000px; padding: 8px; border: 2px dashed rgba(0,0,0,.15); border-radius: 6px; }
  .droppable:empty::before { content: "Déposez ici"; opacity: .6; font-size: .9rem; }
</style>
{% endblock %}
