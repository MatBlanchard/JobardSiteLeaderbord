<!-- leaderboard/templates/leaderboard/manage_categories.html -->

{% extends "leaderboard/admin_dashboard.html" %}
{% block content %}

<h2>Gestion des catégories</h2>

<div style="display: flex; gap: 40px;">
    <!-- Liste des catégories existantes -->
    <div style="flex: 1; border-right: 1px solid #ccc; padding-right: 20px;">
        <h3>Catégories existantes</h3>
        <ul>
            {% for category in categories %}
                <li>
                    <strong>{{ category.name }}</strong> ({{ category.cars.count }} voitures)
                </li>
            {% empty %}
                <li>Aucune catégorie</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Création nouvelle catégorie -->
    <div style="flex: 2;">
        <h3>Nouvelle catégorie</h3>
        <form method="post">
            {% csrf_token %}
            <label for="category_name">Nom de la catégorie :</label>
            <input type="text" name="category_name" required><br><br>

            <h4>Choisissez les classes et/ou voitures :</h4>
            <ul style="list-style: none; padding: 0;">
                {% for cls in classes %}
                    <li>
                        <label>
                            <input type="checkbox" name="classes" value="{{ cls.id }}">
                            {{ cls.name }}
                        </label>
                        <button type="button" onclick="toggleCars('cars-{{ cls.id }}')">⯈</button>

                        <ul id="cars-{{ cls.id }}" style="display: none; margin-left: 20px; list-style: none; padding: 0;">
                            {% for car in cls.cars.all %}
                                <li>
                                    <label>
                                        <input type="checkbox" name="cars" value="{{ car.id }}">
                                        {{ car.name }}
                                    </label>
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                {% endfor %}
            </ul>

            <br>
            <button type="submit">Créer la catégorie</button>
        </form>
    </div>
</div>

<script>
function toggleCars(id) {
    let el = document.getElementById(id);
    el.style.display = (el.style.display === "none") ? "block" : "none";
}
</script>

{% endblock %}